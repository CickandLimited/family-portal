{% extends "base.html" %}

{% block content %}
<section class="space-y-4">
  <h1 class="text-3xl font-bold">Device Manager</h1>
  <p class="text-slate-600">
    Review detected devices, assign friendly names, and connect them to family members.
  </p>
</section>

<section class="mt-6 rounded-lg bg-white p-6 shadow">
  {% if devices %}
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-slate-200 text-sm">
      <thead class="bg-slate-50">
        <tr>
          <th class="px-3 py-2 text-left font-semibold uppercase tracking-wide text-slate-600">Device ID</th>
          <th class="px-3 py-2 text-left font-semibold uppercase tracking-wide text-slate-600">Friendly name</th>
          <th class="px-3 py-2 text-left font-semibold uppercase tracking-wide text-slate-600">Linked user</th>
          <th class="px-3 py-2 text-left font-semibold uppercase tracking-wide text-slate-600">Created</th>
          <th class="px-3 py-2 text-left font-semibold uppercase tracking-wide text-slate-600">Last seen</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        {% for device in devices %}
        <tr class="align-top">
          <td class="px-3 py-3 font-mono text-xs text-slate-500">{{ device.id }}</td>
          <td class="px-3 py-3">
            <form class="flex gap-2" method="post" action="{{ url_for('rename_device', device_id=device.id) }}">
              <input
                class="w-full rounded border border-slate-300 px-2 py-1"
                type="text"
                name="friendly_name"
                value="{{ device.friendly_name or '' }}"
                placeholder="Add a nickname"
              />
              <button class="rounded bg-slate-800 px-3 py-1 text-xs font-semibold text-white" type="submit">
                Save
              </button>
            </form>
          </td>
          <td class="px-3 py-3">
            <form class="flex gap-2" method="post" action="{{ url_for('link_device_user', device_id=device.id) }}">
              <select class="w-full rounded border border-slate-300 px-2 py-1" name="user_id">
                <option value="" {% if not device.linked_user_id %}selected{% endif %}>Unassigned</option>
                {% for user in users %}
                <option value="{{ user.id }}" {% if user.id == device.linked_user_id %}selected{% endif %}>
                  {{ user.display_name }}
                </option>
                {% endfor %}
              </select>
              <button class="rounded bg-slate-800 px-3 py-1 text-xs font-semibold text-white" type="submit">
                Update
              </button>
            </form>
          </td>
          <td class="px-3 py-3 text-xs text-slate-500">
            {{ device.created_at.strftime('%Y-%m-%d %H:%M') if device.created_at else '—' }}
          </td>
          <td class="px-3 py-3 text-xs text-slate-500">
            {{ device.last_seen_at.strftime('%Y-%m-%d %H:%M') if device.last_seen_at else '—' }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="text-slate-600">No devices have checked in yet.</p>
  {% endif %}
</section>
{% endblock %}
