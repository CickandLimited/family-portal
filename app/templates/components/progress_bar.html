{% set display_label = label or "Progress" %}
{% set unit_label = unit %}
{% set value_label = value %}
{% set caption_text = caption %}
{% set size_value = size or 'md' %}
{% set accent_class = accent or 'bg-indigo-500' %}
{% set current_value = current %}
{% set target_value = target %}
{% set show_ratio = current_value is not none and target_value is not none %}
{% set ns = namespace(percent=percent) %}
{% if ns.percent is none and show_ratio and target_value != 0 %}
  {% set ns.percent = (current_value / target_value) * 100 %}
{% endif %}
{% if ns.percent is none %}
  {% set ns.percent = 0 %}
{% endif %}
{% if ns.percent < 0 %}
  {% set ns.percent = 0 %}
{% elif ns.percent > 100 %}
  {% set ns.percent = 100 %}
{% endif %}
{% if size_value == 'sm' %}
  {% set track_height = 'h-1.5' %}
{% elif size_value == 'lg' %}
  {% set track_height = 'h-3' %}
{% else %}
  {% set track_height = 'h-2' %}
{% endif %}
{% set track_classes = track_height ~ ' w-full rounded-full bg-slate-200' %}
{% set bar_classes = track_height ~ ' rounded-full ' ~ accent_class ~ ' transition-all duration-300' %}

<div class="w-full">
  <div class="flex items-center justify-between text-xs text-slate-500">
    <span class="font-medium text-slate-600">{{ display_label }}</span>
    {% if value_label is not none %}
      <span>{{ value_label }}</span>
    {% elif show_ratio %}
      <span>
        {{ current_value }} / {{ target_value }}{% if unit_label %} {{ unit_label }}{% endif %}
      </span>
    {% else %}
      <span>{{ ns.percent | round(0, 'floor') }}%</span>
    {% endif %}
  </div>
  <div class="mt-2 {{ track_classes }}" aria-hidden="true">
    <div
      class="{{ bar_classes }}"
      style="width: {{ ns.percent }}%;"
      role="progressbar"
      aria-valuenow="{{ ns.percent | round(0, 'floor') }}"
      aria-valuemin="0"
      aria-valuemax="100"
    ></div>
  </div>
  {% if caption_text %}
    <p class="mt-2 text-xs text-slate-500">{{ caption_text }}</p>
  {% endif %}
</div>
